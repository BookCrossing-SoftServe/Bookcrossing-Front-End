<div class="my-comment">

  <div class="row bootstrap snippets">
    <div class=" col-md-offset-2 col-sm-12">
      <div class="comment-wrapper">
        <div class="panel panel-info ">
          <ngx-star-rating class="rating" [filledColor]="'#FF8800'" (rated)="onRatingSet($event)" [rating]="rating"></ngx-star-rating>
          <div>
            <div>
                <textarea class="form-control main-comment"
                          placeholder="Write a comment up to 500 characters"
                          #Text
                          [(ngModel)]="text"
                          (input)="onCommentInput(Text, 500)"
                >
                </textarea>
            </div>

            <button [disabled]="!canCommit()" type="button" (click)="PostComment()" class="btn btn-info pull-right comment-post-btn">
              Post
            </button>
            <a *ngIf="!isAuthenticated()" [routerLink]="['/login']">login to comment</a>

            <hr>
            <ul class="media-list">

              <li *ngFor="let comment of comments; let i = index" [attr.data-index]="i" class="media">

                <a class="pull-left">
                  <ngx-avatar [name]="getUserName(comment.owner)"></ngx-avatar>
                </a>

                <div class="media-body pad">

                  <span class="time-value pull-right">
                        {{ formatDate(comment.date) }}
                  </span>
                  <strong *ngIf="!comment.isDeleted" class="text-success">by {{getUserName(comment.owner)}}</strong>

                  <a *ngIf="!comment.isDeleted && canEditComment(comment.owner)"
                     [attr.data-target]="'#root_'+ i + '_edit'"
                     [attr.aria-controls]="'root_'+ i + '_edit'"
                     aria-expanded="false"
                     data-toggle="collapse"
                     role="button"
                     class="btn-text"
                     href="#">
                    Edit
                  </a>

                  <button *ngIf="!comment.isDeleted && canEditComment(comment.owner)"
                          (click)="onDeleteComment(comment.id)"
                          role="button"
                          class="btn-text"
                  >
                    Delete
                  </button>

                  <ngx-star-rating *ngIf="!comment.isDeleted && comment.rating !== 0" [filledColor]="'#FF8800'" [rating]="comment.rating" readonly="true"></ngx-star-rating>
                  <p *ngIf="!comment.isDeleted; else DeletedMessage">
                    {{comment.text}}
                  </p>
                  <ng-template #DeletedMessage>
                    <p class="text-deleted">
                      [The comment was deleted]
                    </p>
                  </ng-template>

                  <small *ngIf="!comment.isDeleted">
                    <a data-toggle="collapse" [attr.data-target]="'#root_'+ i + '_reply'" aria-expanded="true" [attr.aria-controls]="'root_'+ i + '_reply'"
                       class="reply-btn">
                      Reply
                    </a>
                  </small>

                  <div class="accordion" id="accordionExample_{{i}}">

                    <div [attr.id]="'root_'+ i + '_reply'" class="collapse" [attr.data-parent]="'#accordionExample_' + i">

                      <!--Reply form-->
                      <div>
                        <textarea class="form-control sub-comment"
                                  placeholder="Write a reply up to 500 characters"
                                  #Subcomment
                                  (input)="onCommentInput(Subcomment, 500)"
                        ></textarea>
                      </div>

                      <button [disabled]="Subcomment.value.length === 0"
                              (click)="PostChildComment(Subcomment.value, returnID(comment.id))"
                              type="button"
                              class="btn btn-info pull-right comment-post-btn">
                        Post
                      </button>
                    </div>

                    <div [attr.id]="'root_'+ i + '_edit'" class="collapse" [attr.data-parent]="'#accordionExample_' + i">

                      <!--Edit form-->
                      <form #updateFrom="ngForm">
                        <ngx-star-rating [filledColor]="'#FF8800'" [rating]="comment.rating" (rated)="onEditRatingSet($event)"></ngx-star-rating>
                        <div>
                        <textarea class="form-control sub-comment"
                                  placeholder="Write a reply up to 500 characters"
                                  [ngModel]="comment.text"
                                  name="text"
                                  #EditComment
                                  (input)="onCommentInput(EditComment, 500)"
                        ></textarea>
                        </div>

                        <button [disabled]="EditComment.value.length === 0"
                                (click)="updateComment(comment.id,updateFrom.value.text, comment.rating)"
                                type="button"
                                class="btn btn-info pull-right comment-post-btn">
                          Post
                        </button>
                      </form>

                    </div>
                  </div>





                  <ng-template [ngIf]="comment.comments.length > 0">
                    <a data-toggle="collapse" href="#root_subcomments_{{i}}" role="button"
                       aria-expanded="false" [attr.aria-controls]="'root_subcomments_' + i">
                      <div class="hidden">
                        View all {{comment.comments.length}} replies
                        <i class="arrow-down"></i>
                      </div>

                      <div class="shown">
                        Hide all {{comment.comments.length}} replies
                        <i class="arrow-up"></i>
                      </div>
                    </a>

                    <div class="collapse" id="root_subcomments_{{i}}">
                      <app-childcomment (update)="UpdateComments()"
                                        [comments]="comment.comments"
                                        [level]="level + 1"
                                        [rootIteratorNum]="i"
                                        [user]="user"
                                        [ids]="returnID(comment.id)"
                                        [isAuthorized]="isAuthenticated()"></app-childcomment>

                    </div>
                  </ng-template>

                </div>
              </li>

            </ul>
          </div>
        </div>
      </div>

    </div>
  </div>
</div>
